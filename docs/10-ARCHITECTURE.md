# ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

> **ç›®æ ‡**: æ·±å…¥ç†è§£AI Search Engineçš„æ•´ä½“æ¶æ„ã€æ ¸å¿ƒç»„ä»¶å’Œè®¾è®¡ç†å¿µ

---

## ğŸ¯ æ¶æ„æ¦‚è§ˆ

### é«˜å±‚æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ·ç•Œé¢å±‚                     â”‚
â”‚   Web UI    CLI    Python API          â”‚
â”‚  (FastAPI) (Typer)  (Direct)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è·¯ç”±å±‚ (Router)                  â”‚
â”‚  - å…³é”®è¯åˆ†ç±» (å¿«é€Ÿ)                    â”‚
â”‚  - LLMåˆ†ç±» (ç²¾ç¡®)                       â”‚
â”‚  - æ··åˆåˆ†ç±» (å¹³è¡¡)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Agent å±‚                       â”‚
â”‚  Research  Code   Chat   RAG            â”‚
â”‚  Weather   Finance Routing Workflow     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         LLM ç®¡ç†å±‚                       â”‚
â”‚  å¤šæä¾›å•†æ”¯æŒ + è‡ªåŠ¨fallback             â”‚
â”‚  OpenAI / DashScope / DeepSeek         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å·¥å…·å±‚ (Tools)                   â”‚
â”‚  Search  Scraper  CodeExecutor          â”‚
â”‚  VectorStore  OCR  Vision               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æ•°æ®å±‚                         â”‚
â”‚  ChromaDB  SQLite  Cache  Files         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¡ è®¾è®¡åŸåˆ™

### 1. æ¨¡å—åŒ– (Modularity)
- å•ä¸€èŒè´£
- æ¾è€¦åˆ
- å¯æ’æ‹”

### 2. å¼‚æ­¥ä¼˜å…ˆ (Async-First)
- æ‰€æœ‰I/Oæ“ä½œä½¿ç”¨ `async/await`
- å¹¶å‘å¤„ç†æå‡æ€§èƒ½

### 3. é…ç½®é©±åŠ¨ (Configuration-Driven)
- é›†ä¸­é…ç½® `config/config.yaml`
- ç¯å¢ƒå˜é‡è¦†ç›–

### 4. å®‰å…¨ç¬¬ä¸€ (Security-First)
- ä»£ç æ‰§è¡Œæ²™ç®±
- APIå¯†é’¥ç¯å¢ƒå˜é‡
- è¶…æ—¶å’Œèµ„æºé™åˆ¶

### 5. å¯æ‰©å±•æ€§ (Extensibility)
- æ’ä»¶å¼æ¶æ„
- æ ‡å‡†åŒ–æ¥å£

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶
- Python 3.10+
- FastAPI 0.104+
- Uvicorn (ASGIæœåŠ¡å™¨)
- Pydantic (æ•°æ®éªŒè¯)

### LLMé›†æˆ
- OpenAI (gpt-3.5-turbo, gpt-4)
- DashScope (qwen3-max, qwen-turbo)
- DeepSeek (deepseek-chat)
- Ollama (æœ¬åœ°æ¨¡å‹)

### æ•°æ®å­˜å‚¨
- ChromaDB (å‘é‡æ•°æ®åº“)
- SQLite (å¯¹è¯å†å²)
- aiosqlite (å¼‚æ­¥)

### AI/MLåº“
- sentence-transformers (Embeddings)
- langchain (LLMæ¡†æ¶)
- llama-index (RAGæ¡†æ¶)
- PaddleOCR (OCRè¯†åˆ«)

### å‰ç«¯æŠ€æœ¯
- HTMX (åŠ¨æ€äº¤äº’)
- Jinja2 (æ¨¡æ¿)
- Pygments (ä»£ç é«˜äº®)

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶

### 1. Router (è·¯ç”±å™¨)

**èŒè´£**: å°†æŸ¥è¯¢åˆ†ç±»å¹¶è·¯ç”±åˆ°å¯¹åº”Agent

**æ–‡ä»¶**: `src/router.py`

**åˆ†ç±»æ–¹æ³•**:

```python
class Router:
    # å…³é”®è¯åˆ†ç±» (å¿«é€Ÿ)
    def classify(self, query: str) -> TaskType:
        pass
    
    # LLMåˆ†ç±» (ç²¾ç¡®)
    async def classify_with_llm(self, query: str) -> dict:
        pass
    
    # æ··åˆåˆ†ç±» (å¹³è¡¡)
    async def classify_hybrid(self, query: str) -> dict:
        pass
```

**ä»»åŠ¡ç±»å‹**:
- RESEARCH: ç½‘é¡µæœç´¢ç ”ç©¶
- CODE: ä»£ç ç”Ÿæˆæ‰§è¡Œ
- CHAT: å¯¹è¯èŠå¤©
- RAG: æ–‡æ¡£æ£€ç´¢é—®ç­”
- DOMAIN_WEATHER: å¤©æ°”æŸ¥è¯¢
- DOMAIN_FINANCE: é‡‘èæ•°æ®
- DOMAIN_ROUTING: è·¯ç”±å¯¼èˆª

---

### 2. LLM Manager

**èŒè´£**: ç»Ÿä¸€ç®¡ç†å¤šä¸ªLLMæä¾›å•†

**æ–‡ä»¶**: `src/llm/manager.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- å¤šæä¾›å•†åˆå§‹åŒ–
- è‡ªåŠ¨fallback
- ç»Ÿä¸€APIæ¥å£

```python
class LLMManager:
    def __init__(self, config):
        self.providers = {}
        self._initialize_providers()
    
    async def complete(self, prompt: str) -> str:
        # å°è¯•æ‰€æœ‰å¯ç”¨provider
        pass
```

---

### 3. Agent ç³»ç»Ÿ

#### ResearchAgent
1. ç”Ÿæˆæœç´¢è®¡åˆ’
2. æ‰§è¡Œå¹¶å‘æœç´¢
3. çˆ¬å–å†…å®¹
4. ç»¼åˆæ€»ç»“

#### CodeAgent
1. ç”Ÿæˆä»£ç 
2. éªŒè¯å®‰å…¨æ€§
3. æ²™ç®±æ‰§è¡Œ
4. è§£é‡Šç»“æœ

#### RAG Agent
1. EmbeddingæŸ¥è¯¢
2. æ£€ç´¢ç›¸å…³chunks
3. Reranking (å¯é€‰)
4. ç”Ÿæˆç­”æ¡ˆ

---

### 4. Web UI (FastAPI)

**æ–‡ä»¶**: `src/web/app.py`

**è·¯ç”±æ¨¡å—**:
- main.py (é¦–é¡µ)
- query.py (ç»Ÿä¸€æŸ¥è¯¢)
- rag.py (æ–‡æ¡£ä¸Šä¼ )
- multimodal.py (OCR + Vision)
- tools.py (å¤©æ°”/é‡‘è/è·¯ç”±)
- workflow.py (å·¥ä½œæµ)

**HTMXäº¤äº’**:
```html
<form hx-post="/query" hx-target="#result">
    <input name="query" />
</form>
```

---

### 5. å·¥å…·å±‚

| å·¥å…· | åŠŸèƒ½ |
|------|------|
| SearchTool | ç½‘é¡µæœç´¢ |
| ScraperTool | å†…å®¹çˆ¬å– |
| CodeExecutor | ä»£ç æ‰§è¡Œ |
| VectorStore | å‘é‡æ£€ç´¢ |
| OCRTool | æ–‡å­—è¯†åˆ« |
| VisionTool | å›¾åƒç†è§£ |
| WeatherTool | å¤©æ°”æŸ¥è¯¢ |
| FinanceTool | é‡‘èæ•°æ® |
| RoutingTool | è·¯ç”±å¯¼èˆª |

---

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·è¾“å…¥
  â†“
Routeråˆ†ç±»
  â†“
Agentå¤„ç†
  â”œâ”€ è°ƒç”¨LLM
  â”œâ”€ ä½¿ç”¨Tools
  â””â”€ å¤„ç†ç»“æœ
  â†“
è¿”å›ç”¨æˆ·
  â†“
ä¿å­˜å†å²
```

---

## ğŸš€ æ‰©å±•æ€§

### æ·»åŠ æ–°LLM Provider

```python
class CustomLLMClient(BaseLLM):
    async def complete(self, prompt):
        pass
```

### æ·»åŠ æ–°Agent

```python
class CustomAgent:
    async def execute(self, input_data):
        pass
```

### æ·»åŠ æ–°Tool

```python
class CustomTool(BaseTool):
    async def execute(self, *args):
        pass
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

1. **å¼‚æ­¥å¹¶å‘**: asyncio.gather()
2. **ç¼“å­˜ç­–ç•¥**: Redis/SQLite
3. **è¿æ¥æ± **: aiohttpè¿æ¥æ± 
4. **æ‰¹å¤„ç†**: æ‰¹é‡embedding

---

## ğŸ“Œ ä¸‹ä¸€æ­¥

- [11-INTELLIGENT-ROUTING.md](11-INTELLIGENT-ROUTING.md) - æ™ºèƒ½è·¯ç”±
- [12-AGENT-SYSTEM.md](12-AGENT-SYSTEM.md) - Agentç³»ç»Ÿ
- [13-DATA-FLOW.md](13-DATA-FLOW.md) - æ•°æ®æµ

---

**ç†è§£æ¶æ„æ˜¯æŒæ¡ç³»ç»Ÿçš„ç¬¬ä¸€æ­¥! ğŸš€**
