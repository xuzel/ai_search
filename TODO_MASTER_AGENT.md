# MasterAgentç»Ÿä¸€ä¸»é¡µé¢å®æ–½TODOæ¸…å•

## ğŸ“‹ é¡¹ç›®ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡ï¼š** å°†ä¸»é¡µé¢æ”¹é€ ä¸ºç»Ÿä¸€æ™ºèƒ½åŠ©æ‰‹å…¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸€ä¸ªé¡µé¢è®¿é—®æ‰€æœ‰åŠŸèƒ½ï¼ˆRAGã€OCRã€Visionã€Weatherã€Financeã€Routingç­‰ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å¹¶è°ƒç”¨æ‰€éœ€å·¥å…·ï¼Œæ‰€æœ‰ç»“æœç»LLMå¢å¼ºåä»¥è‡ªç„¶è¯­è¨€è¿”å›ã€‚

**å®ç°æ–¹å¼ï¼š** åŸºäºå·¥ä½œæµæ¨¡å¼ï¼ˆTaskDecomposer + WorkflowEngine + ResultAggregatorï¼‰è‡ªåŠ¨ç¼–æ’å¤šå·¥å…·è°ƒç”¨ï¼Œä¸ä¾èµ–Function Callingã€‚

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### Phase 1: æ ¸å¿ƒæ¶æ„ (å·²å®Œæˆ âœ…)

#### 1.1 åˆ›å»ºMasterAgent (`src/agents/master_agent.py`) âœ…
- [x] ç»Ÿä¸€æŸ¥è¯¢å¤„ç†å™¨ï¼Œé›†æˆæ‰€æœ‰å·¥å…·å’Œæ™ºèƒ½ä½“
- [x] æ–‡ä»¶å¤„ç†é€»è¾‘ï¼ˆå›¾ç‰‡â†’OCR/Visionï¼Œæ–‡æ¡£â†’RAGï¼‰
- [x] ä»»åŠ¡åˆ†è§£ï¼ˆTaskDecomposerï¼‰
- [x] å·¥ä½œæµæ‰§è¡Œï¼ˆWorkflowEngineï¼‰
- [x] ç»“æœèšåˆï¼ˆResultAggregatorï¼‰
- [x] LLMå¢å¼ºæ‰€æœ‰å·¥å…·è¾“å‡º
- [x] å·¥å…·æ‰§è¡Œå™¨æ³¨å†Œè¡¨ï¼ˆ9ä¸ªå·¥å…·ï¼‰

**ä»£ç è¡Œæ•°ï¼š** ~650è¡Œ

**é›†æˆçš„å·¥å…·ï¼š**
- ResearchAgentï¼ˆç½‘ç»œæœç´¢ï¼‰
- CodeAgentï¼ˆä»£ç æ‰§è¡Œï¼‰
- ChatAgentï¼ˆå¯¹è¯ï¼‰
- RAGAgentï¼ˆæ–‡æ¡£é—®ç­”ï¼‰
- WeatherToolï¼ˆå¤©æ°”ï¼‰
- FinanceToolï¼ˆè‚¡ç¥¨ï¼‰
- RoutingToolï¼ˆè·¯çº¿ï¼‰
- OCRToolï¼ˆæ–‡å­—è¯†åˆ«ï¼‰
- VisionToolï¼ˆå›¾åƒåˆ†æï¼‰

#### 1.2 ä¸»é¡µé¢å‡çº§ (`src/web/templates/pages/home.html`) âœ…
- [x] æ·»åŠ æ–‡ä»¶ä¸Šä¼ æ§ä»¶ï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰
- [x] æ–‡ä»¶é¢„è§ˆå’Œæ™ºèƒ½æç¤º
- [x] æ›´æ–°"Coming Soon"ä¸º"Available Now"
- [x] æ·»åŠ æ–‡ä»¶ä¸Šä¼ ç¤ºä¾‹æŒ‰é’®
- [x] æ–°å¢å¤©æ°”ã€è‚¡ç¥¨æŸ¥è¯¢ç¤ºä¾‹
- [x] CSSæ ·å¼ï¼ˆæ‹–æ‹½hoveræ•ˆæœï¼‰
- [x] JavaScriptæ–‡ä»¶å¤„ç†é€»è¾‘

#### 1.3 ç®€åŒ–query.py (`src/web/routers/query.py`) âœ…
- [x] ä»462è¡Œç®€åŒ–åˆ°170è¡Œ
- [x] æ”¯æŒæ–‡ä»¶ä¸Šä¼ ï¼ˆUploadFileï¼‰
- [x] å•ä¸€MasterAgentå¤„ç†æ‰€æœ‰è¯·æ±‚
- [x] ç»Ÿä¸€ç»“æœæ ¼å¼
- [x] é”™è¯¯å¤„ç†ä¼˜åŒ–

#### 1.4 ç»Ÿä¸€ç»“æœæ¨¡æ¿ (`src/web/templates/components/result_unified.html`) âœ…
- [x] å·¥å…·è°ƒç”¨åˆ—è¡¨å±•ç¤ºï¼ˆå¸¦å›¾æ ‡ï¼‰
- [x] LLMå¢å¼ºçš„è‡ªç„¶è¯­è¨€ç­”æ¡ˆ
- [x] æ¥æºé“¾æ¥ï¼ˆå¦‚æœæœ‰ï¼‰
- [x] å…³é”®ç‚¹æå–
- [x] è¯¦ç»†æ•°æ®ï¼ˆå¯æŠ˜å ï¼‰
- [x] å“åº”å¼è®¾è®¡
- [x] æ‰“å°æ ·å¼

#### 1.5 ä¾èµ–æ³¨å…¥ç³»ç»Ÿ âœ…
- [x] `get_master_agent()` å·¥å‚å‡½æ•°ï¼ˆ`src/web/dependencies/core.py`ï¼‰
- [x] é›†æˆæ‰€æœ‰å·¥å…·ä¾èµ–
- [x] å¯¼å‡ºåˆ° `__init__.py`
- [x] å•ä¾‹æ¨¡å¼ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰

#### 1.6 æ¨¡å—å¯¼å‡º âœ…
- [x] `src/agents/__init__.py` å¯¼å‡ºMasterAgent

### Phase 2: Bugä¿®å¤ (å·²å®Œæˆ âœ…)

#### 2.1 æ¨¡æ¿è·¯å¾„ä¿®å¤ âœ…
- [x] ä¿®å¤æ¨¡æ¿è·¯å¾„ï¼š`result_unified.html` â†’ `components/result_unified.html`

#### 2.2 å·¥å…·APIé€‚é… âœ…
- [x] WeatherTool: `get_weather()` â†’ `get_current_weather()`
- [x] FinanceTool: `get_stock_data()` â†’ `get_stock_price()`
- [x] WeatherToolæ¸©åº¦å•ä½ï¼š`metric` â†’ `celsius` (PyOWMå…¼å®¹æ€§)

#### 2.3 VisionToolåˆå§‹åŒ–ä¿®å¤ âœ…
- [x] ç§»é™¤ `llm_manager` å‚æ•°
- [x] ä½¿ç”¨ `api_key` å’Œ `model` å‚æ•°

### Phase 0: å…³é”®Bugä¿®å¤ (2025-11-23 æ–°å¢ï¼Œå·²å®Œæˆ âœ…)

**é€šè¿‡ä»£ç è°ƒç ”å‘ç°çš„è¿è¡Œæ—¶é˜»å¡æ€§é—®é¢˜**

#### 0.1 RAGAgent APIä¸åŒ¹é… âœ…
- [x] ä¿®å¤ `upload_document()` â†’ `ingest_document()`
- **ä½ç½®**: `src/agents/master_agent.py:342`
- **åŸå› **: RAGAgentå®é™…æ–¹æ³•åä¸º `ingest_document()`
- **å½±å“**: æ–‡æ¡£ä¸Šä¼ åŠŸèƒ½æ— æ³•å·¥ä½œ

**ä¿®å¤ä»£ç ï¼š**
```python
# ä¿®æ”¹å‰
await self.rag_agent.upload_document(file_path)

# ä¿®æ”¹å
await self.rag_agent.ingest_document(file_path)
```

#### 0.2 WorkflowEngine APIä¸åŒ¹é… âœ…
- [x] ä¿®å¤å·¥ä½œæµåˆ›å»ºå’Œæ‰§è¡Œæ–¹å¼
- **ä½ç½®**: `src/agents/master_agent.py:398-415`
- **åŸå› **: WorkflowEngineæ²¡æœ‰ `add_tasks()` æ–¹æ³•ï¼Œ`execute()` ä¸æ¥å— `mode` å‚æ•°
- **å½±å“**: å¤šå·¥å…·ç¼–æ’åŠŸèƒ½æ— æ³•å·¥ä½œ

**ä¿®å¤ä»£ç ï¼š**
```python
# ä¿®æ”¹å‰
self.workflow_engine.add_tasks(tasks)
await self.workflow_engine.execute(mode=ExecutionMode.DAG)

# ä¿®æ”¹å
workflow = self.workflow_engine.create_workflow(
    workflow_id=f"master_plan_{task_plan.goal[:30]}",
    mode=ExecutionMode.DAG
)
for task in tasks:
    workflow.tasks[task.id] = task
await self.workflow_engine.execute(workflow)
```

#### 0.3 Workflowä¾èµ–æ³¨å…¥ä¸å…¼å®¹ âœ…
- [x] ä¿®å¤ `task_func` å‚æ•°ç­¾å
- **ä½ç½®**: `src/agents/master_agent.py:376`
- **åŸå› **: WorkflowEngineä¼šè‡ªåŠ¨æ³¨å…¥ `{dep_id}_result` kwargsï¼Œä½†task_funcæ²¡æœ‰æ¥å—
- **å½±å“**: æœ‰ä¾èµ–å…³ç³»çš„å¤šä»»åŠ¡å·¥ä½œæµæ‰§è¡Œå¤±è´¥

**ä¿®å¤ä»£ç ï¼š**
```python
# ä¿®æ”¹å‰
async def task_func(st=subtask, exec_func=executor, store=results_store, ctx=file_context):

# ä¿®æ”¹å
async def task_func(st=subtask, exec_func=executor, store=results_store, ctx=file_context, **kwargs):
    # **kwargs æ¥å—WorkflowEngineæ³¨å…¥çš„ä¾èµ–ç»“æœ
```

---

## ğŸ”§ å¾…å®Œæˆçš„å·¥ä½œ

### Phase 3: åŠŸèƒ½éªŒè¯æµ‹è¯• (å·²å®Œæˆ âœ…)

#### 3.1 ChatAgent APIéªŒè¯ âœ…
- [x] æ£€æŸ¥ `chat()` æ–¹æ³•å­˜åœ¨ä¸”è¿”å›string
- [x] ç¡®è®¤è¿”å›æ ¼å¼ç»Ÿä¸€
- **ç»“æœ**: ChatAgent.chat()æ­£å¸¸å·¥ä½œï¼Œè¿”å›stringç±»å‹

**æµ‹è¯•å‘½ä»¤ï¼š**
```bash
# æµ‹è¯•èŠå¤©åŠŸèƒ½
curl -X POST "http://localhost:8005/query" -F "query=ç»™æˆ‘è®²ä¸ªç¬‘è¯"
# ç»“æœ: âœ… 200 OK
```

#### 3.2 RAGAgenté›†æˆéªŒè¯ âœ…
- [x] ç¡®è®¤ `ingest_document()` æ–¹æ³•å­˜åœ¨ï¼ˆå·²ä¿®å¤APIåç§°ï¼‰
- [x] ç¡®è®¤ `query()` æ–¹æ³•è¿”å›æ ¼å¼æ­£ç¡®
- [x] æµ‹è¯•æ–‡æ¡£ä¸Šä¼ å’ŒæŸ¥è¯¢æµç¨‹

**æµ‹è¯•ç»“æœï¼š**
```bash
curl -X POST "http://localhost:8005/query" \
  -F "query=æ€»ç»“è¿™ä¸ªæ–‡æ¡£çš„å†…å®¹" \
  -F "file=@./tmp.pdf"
# ç»“æœ: âœ… 200 OK (æ–‡æ¡£ä¸Šä¼ æˆåŠŸ)
```

#### 3.3 WorkflowEngineé€‚é…éªŒè¯ âœ…
- [x] æ£€æŸ¥ `Task` ç±»æ”¯æŒåŠ¨æ€å‡½æ•°æ³¨å†Œ âœ…
- [x] ä¿®å¤ `create_workflow()` å’Œ `execute(workflow)` è°ƒç”¨æ–¹å¼ âœ…
- [x] æµ‹è¯•DAGæ¨¡å¼å¤šä»»åŠ¡æ‰§è¡Œ âœ…

**æœ€ç»ˆä½¿ç”¨æ–¹å¼ï¼š**
```python
# åˆ›å»ºWorkflow
workflow = self.workflow_engine.create_workflow(
    workflow_id=f"master_plan_{task_plan.goal[:30]}",
    mode=ExecutionMode.DAG
)

# æ·»åŠ ä»»åŠ¡
for task in tasks:
    workflow.tasks[task.id] = task

# æ‰§è¡Œå·¥ä½œæµ
await self.workflow_engine.execute(workflow)
```

**æµ‹è¯•ç»“æœï¼š**
```bash
curl -X POST "http://localhost:8005/query" \
  -F "query=åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼ŸTSLAè‚¡ä»·å¤šå°‘ï¼Ÿ"
# ç»“æœ: âœ… 200 OK (å¤šå·¥å…·å¹¶è¡Œæ‰§è¡ŒæˆåŠŸ)
```

#### 3.4 Entity ExtractoréªŒè¯ âœ…
- [x] ç¡®è®¤ `extract_location()` å­˜åœ¨äº `src/utils/entity_extractor.py` âœ…
- [x] ç¡®è®¤ `extract_stock_symbol()` å­˜åœ¨ âœ…
- [x] ç¡®è®¤ `extract_route()` å­˜åœ¨ âœ…
- **ç»“æœ**: æ‰€æœ‰å‡½æ•°éƒ½å·²å®ç°ï¼Œæ­£å¸¸å·¥ä½œ

#### 3.5 ç»¼åˆåŠŸèƒ½æµ‹è¯• âœ…

**åŸºç¡€å·¥å…·æµ‹è¯• (4/4é€šè¿‡)**:
- âœ… èŠå¤©: "ç»™æˆ‘è®²ä¸ªç¬‘è¯" â†’ 200 OK
- âœ… å¤©æ°”: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ" â†’ 200 OK
- âœ… ä»£ç : "è®¡ç®—fibonacciæ•°åˆ—çš„ç¬¬10é¡¹" â†’ 200 OK (ç»“æœ: 55)
- âœ… è‚¡ç¥¨: "AAPLè‚¡ä»·å¤šå°‘ï¼Ÿ" â†’ 200 OK

**æ–‡ä»¶ä¸Šä¼ æµ‹è¯• (3/3é€šè¿‡)**:
- âœ… å›¾ç‰‡åˆ†æ (Vision): test_image.png â†’ 200 OK
- âœ… æ–‡å­—è¯†åˆ« (OCR): test_image_chinese.png â†’ 200 OK
- âœ… æ–‡æ¡£ä¸Šä¼  (RAG): tmp.pdf â†’ 200 OK

**å¤šå·¥å…·ç»„åˆæµ‹è¯• (1/1é€šè¿‡)**:
- âœ… "åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼ŸTSLAè‚¡ä»·å¤šå°‘ï¼Ÿ" â†’ 200 OK

---

### Phase 4: UI/UXä¼˜åŒ– (2025-11-23 å·²å®Œæˆ âœ…)

#### 4.1 é‡å®šå‘ä¸“é—¨é¡µé¢ âœ…
- [x] ä¿®æ”¹ `src/web/routers/main.py`
- [x] æ·»åŠ 4ä¸ªé‡å®šå‘è·¯ç”±

**å·²å®ç°ä»£ç ï¼š**
```python
@router.get("/rag")
async def redirect_rag():
    return RedirectResponse(url="/", status_code=302)

@router.get("/multimodal")
async def redirect_multimodal():
    return RedirectResponse(url="/", status_code=302)

@router.get("/tools")
async def redirect_tools():
    return RedirectResponse(url="/", status_code=302)

@router.get("/workflow")
async def redirect_workflow():
    return RedirectResponse(url="/", status_code=302)
```

**æµ‹è¯•ç»“æœï¼š** âœ… `/rag` â†’ `/` (HTTP 302 Redirect)

#### 4.2 æ›´æ–°å¯¼èˆªæ  âœ…
- [x] ä¿ç•™é“¾æ¥ä½†æ”¹ä¸ºæŒ‡å‘ä¸»é¡µ
- [x] æ·»åŠ "é›†æˆ"æ ‡ç­¾æ›¿ä»£"New"æ ‡ç­¾
- [x] æ·»åŠ hoveræç¤ºè¯´æ˜åŠŸèƒ½å·²é›†æˆ

**æ–‡ä»¶ä½ç½®ï¼š** `src/web/templates/layouts/sidebar.html`

**å®ç°æ•ˆæœï¼š**
```html
<a href="/" class="nav-item" title="Document Q&A - å·²é›†æˆåˆ°ä¸»é¡µé¢ï¼Œæ”¯æŒPDF/TXT/MDç­‰æ–‡æ¡£ä¸Šä¼ ">
  <span class="nav-item-icon">ğŸ“š</span>
  <span>Document Q&A</span>
  <span class="badge badge-info nav-item-badge">é›†æˆ</span>
</a>
```

#### 4.3 åŠ è½½åŠ¨ç”»å¢å¼º âœ…
- [x] å¢å¼ºspinneræ ·å¼ï¼ˆæ›´å¤§å°ºå¯¸ã€åŒè‰²è¾¹æ¡†ã€å¼¹æ€§åŠ¨ç”»ï¼‰
- [x] æ·»åŠ å†…éƒ¨å‘å…‰æ•ˆæœï¼ˆpulseåŠ¨ç”»ï¼‰
- [x] loadingæ–‡æœ¬æ·»åŠ æ·¡å…¥æ·¡å‡ºæ•ˆæœ
- [x] æ·»åŠ è‡ªåŠ¨ç‚¹ç‚¹ç‚¹åŠ¨ç”»

**æ–‡ä»¶ä½ç½®ï¼š** `src/web/static/css/new-style.css`

**è§†è§‰æå‡ï¼š**
- Spinnerä»48pxå¢å¤§åˆ°56px
- æ·»åŠ radial-gradientå‘å…‰æ•ˆæœ
- ä½¿ç”¨cubic-bezierå¼¹æ€§åŠ¨ç”»
- æ–‡æœ¬opacityåŠ¨ç”» + ç‚¹ç‚¹ç‚¹æ•ˆæœ

#### 4.4 æ–‡ä»¶ä¸Šä¼ åŒºåŸŸä¼˜åŒ– âœ…
- [x] æ·»åŠ æ¨ªå‘æ‰«å…‰æ•ˆæœ
- [x] hoveræ—¶ä¸Šç§»æ•ˆæœ (translateY(-2px))
- [x] drag-overæ—¶ç¼©æ”¾æ•ˆæœ (scale(1.02))
- [x] å¢å¼ºé˜´å½±å’Œè¾¹æ¡†æ•ˆæœ
- [x] æ–‡ä»¶é¢„è§ˆæ·»åŠ slideInåŠ¨ç”»

**æ–‡ä»¶ä½ç½®ï¼š** `src/web/templates/pages/home.html`

**å®ç°æ•ˆæœï¼š**
- ä¸Šä¼ åŒºåŸŸhoveræœ‰æ‰«å…‰åŠ¨ç”»
- æ‹–æ‹½æ–‡ä»¶æ—¶æœ‰æ˜æ˜¾è§†è§‰åé¦ˆï¼ˆç¼©æ”¾+é˜´å½±ï¼‰
- æ–‡ä»¶é¢„è§ˆæ»‘å…¥åŠ¨ç”»
- ä¼˜åŒ–ä¸Šä¼ æ ‡ç­¾ä¸‹åˆ’çº¿hoveræ•ˆæœ

#### 4.5 å·¥å…·è°ƒç”¨æµç¨‹å¯è§†åŒ– âœ…
- [x] åˆ›å»ºæ¨ªå‘å·¥å…·æµç¨‹å›¾
- [x] æ˜¾ç¤ºæ‰§è¡Œé¡ºåºï¼šQuery â†’ Tool1 â†’ Tool2 â†’ ... â†’ Answer
- [x] æ¯ä¸ªå·¥å…·æ˜¾ç¤ºå›¾æ ‡ + åç§°
- [x] æ·»åŠ æµç¨‹åŠ¨ç”»ï¼ˆflowIn, toolAppearï¼‰
- [x] ç®­å¤´è„‰å†²åŠ¨ç”»
- [x] æœ€åä¸€ä¸ªå·¥å…·é«˜äº®æ˜¾ç¤º

**æ–‡ä»¶ä½ç½®ï¼š** `src/web/templates/components/result_unified.html`

**å®ç°æ•ˆæœï¼š**
```
Execution Flow:
[Query] â†’ [ğŸ” Search] â†’ [ğŸ’¬ Chat] â†’ [Answer]
```
- æ¯ä¸ªå·¥å…·å¡ç‰‡å¯hoverï¼Œæœ‰ä¸Šç§»å’Œé˜´å½±æ•ˆæœ
- æœ€åä¸€ä¸ªå·¥å…·ç”¨successè‰²é«˜äº®
- æ”¯æŒå¤šå·¥å…·æ¢è¡Œæ˜¾ç¤º
- åŠ¨ç”»ä¾æ¬¡å‡ºç°ï¼ˆstagger effectï¼‰

---

### ğŸ“Š Phase 4 å®Œæˆæ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-11-23
**å®Œæˆé¡¹ç›®**: 5/5 (100%)
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡

**è§†è§‰æ•ˆæœæå‡**:
1. åŠ è½½ä½“éªŒï¼šç®€å•spinner â†’ å¸¦å‘å…‰æ•ˆæœçš„åŠ¨æ€spinner + è„‰åŠ¨æ–‡æœ¬
2. æ–‡ä»¶ä¸Šä¼ ï¼šåŸºç¡€è™šçº¿æ¡† â†’ å¸¦æ‰«å…‰ã€é˜´å½±ã€åŠ¨ç”»çš„ç°ä»£ä¸Šä¼ åŒº
3. å·¥å…·å±•ç¤ºï¼šç®€å•badgeåˆ—è¡¨ â†’ å¯è§†åŒ–æ‰§è¡Œæµç¨‹å›¾

**ä¿®æ”¹æ–‡ä»¶æ¸…å•**:
1. `src/web/routers/main.py` - æ·»åŠ 4ä¸ªé‡å®šå‘è·¯ç”±
2. `src/web/templates/layouts/sidebar.html` - æ›´æ–°å¯¼èˆªæ é“¾æ¥å’Œæ ‡ç­¾
3. `src/web/static/css/new-style.css` - å¢å¼ºåŠ è½½åŠ¨ç”»æ ·å¼
4. `src/web/templates/pages/home.html` - ä¼˜åŒ–æ–‡ä»¶ä¸Šä¼ åŒºåŸŸæ ·å¼
5. `src/web/templates/components/result_unified.html` - æ·»åŠ å·¥å…·æµç¨‹å¯è§†åŒ–

---

### Phase 5: TaskDecomposerå¢å¼º (2025-11-23 å·²å®Œæˆ âœ…)

**å®Œæˆæ—¶é—´**: 2025-11-23
**å®Œæˆé¡¹ç›®**: 3/3 (100%)
**æµ‹è¯•çŠ¶æ€**: âœ… å…¨éƒ¨é€šè¿‡

#### 5.1 ç¡®è®¤å·¥å…·è¯†åˆ«å…³é”®è¯ âœ…
- [x] æ£€æŸ¥ `src/workflow/task_decomposer.py` AVAILABLE_TOOLS
- **ç»“æœ**: æ‰€æœ‰9ä¸ªå·¥å…·å‡å·²åŒ…å«

**å·²æœ‰çš„å®Œæ•´å·¥å…·åˆ—è¡¨ï¼š**
```python
AVAILABLE_TOOLS = {
    "search": "Web search for information",
    "code": "Execute Python code for calculations",
    "chat": "General conversation and reasoning",
    "rag": "Query documents and knowledge base",
    "weather": "Get weather information",           # âœ… å·²æœ‰
    "finance": "Get stock and financial data",       # âœ… å·²æœ‰
    "routing": "Get route and navigation information", # âœ… å·²æœ‰
    "vision": "Analyze images",                      # âœ… å·²æœ‰
    "ocr": "Extract text from images",               # âœ… å·²æœ‰
}
```

#### 5.2 ä¼˜åŒ–åˆ†è§£æç¤ºè¯ âœ…
- [x] æ·»åŠ 3ä¸ªæ–°çš„å¤šå·¥å…·ç»„åˆç¤ºä¾‹ï¼ˆå¤©æ°”+è·¯çº¿ã€å¤©æ°”+è‚¡ç¥¨ã€å›¾ç‰‡åˆ†æï¼‰
- [x] ä¼˜åŒ–ä¸­æ–‡æ”¯æŒ

**æ–°å¢ç¤ºä¾‹ï¼ˆ`task_decomposer.py:279-365`ï¼‰ï¼š**

1. **å¤©æ°” + è·¯çº¿ + å»ºè®®**ï¼ˆ3ä¸ªå·¥å…·ä¸²è¡Œï¼‰
```python
Query: "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿå¸®æˆ‘è§„åˆ’å»é•¿åŸçš„è·¯çº¿"
{
    "goal": "è·å–åŒ—äº¬å¤©æ°”å¹¶è§„åˆ’å»é•¿åŸè·¯çº¿",
    "complexity": "medium",
    "subtasks": [
        {"id": "step1", "tool": "weather", "query": "åŒ—äº¬", ...},
        {"id": "step2", "tool": "routing", "query": "åŒ—äº¬åˆ°é•¿åŸ", ...},
        {"id": "step3", "tool": "chat", "query": "æ ¹æ®å¤©æ°”...ç»™å‡ºå»ºè®®",
         "dependencies": ["step1", "step2"], ...}
    ]
}
```

2. **å¤©æ°” + è‚¡ç¥¨**ï¼ˆ2ä¸ªå·¥å…·å¹¶è¡Œï¼‰
```python
Query: "å¸®æˆ‘æŸ¥ä¸€ä¸‹åŒ—äº¬å¤©æ°”å’ŒTSLAçš„è‚¡ä»·"
{
    "subtasks": [
        {"id": "step1", "tool": "weather", ...},
        {"id": "step2", "tool": "finance", ...}
    ]
}
```

3. **å›¾ç‰‡åˆ†æ + OCR + æ•´åˆ**ï¼ˆ3ä¸ªå·¥å…·æ··åˆï¼‰
```python
Query: "è¿™å¼ å›¾ç‰‡æ˜¯ä»€ä¹ˆï¼Ÿæå–é‡Œé¢çš„æ–‡å­—"
{
    "subtasks": [
        {"id": "step1", "tool": "vision", ...},
        {"id": "step2", "tool": "ocr", ...},
        {"id": "step3", "tool": "chat", "query": "æ•´åˆä¿¡æ¯",
         "dependencies": ["step1", "step2"], ...}
    ]
}
```

#### 5.3 æ‰©å±•ä¸­æ–‡å…³é”®è¯ï¼ˆFallback Planï¼‰ âœ…
- [x] å¤§å¹…æ‰©å±•æ‰€æœ‰å·¥å…·çš„ä¸­æ–‡å…³é”®è¯è¯†åˆ«

**å¢å¼ºå†…å®¹ï¼ˆ`task_decomposer.py:405-457`ï¼‰ï¼š**

```python
# Weather: æ–°å¢"æ°”æ¸©"ã€"æ¸©åº¦"ã€"ä¸‹é›¨"ã€"æ™´å¤©"ã€"é˜´å¤©"ã€"é›¾éœ¾"ã€"ä»Šå¤©å¤©æ°”"
# Finance: æ–°å¢"è‚¡ä»·"ã€"è¡Œæƒ…"ã€"è´¢ç»"ã€"é‡‘è"ã€"æ¶¨è·Œ"
# Routing: æ–°å¢"å¯¼èˆª"ã€"è·¯çº¿è§„åˆ’"ã€"æ€ä¹ˆå»"ã€"åœ°å›¾"
# OCR: æ–°å¢"æ–‡å­—è¯†åˆ«"ã€"è¯†åˆ«æ–‡å­—"ã€"æå–æ–‡å­—"ã€"è¯»å–æ–‡å­—"
# Vision: æ–°å¢"å›¾ç‰‡"ã€"å›¾åƒ"ã€"ç…§ç‰‡"ã€"çœ‹å›¾"
# Code: æ–°å¢"ç®—"ã€"æ•°å­¦"ã€"æ–æ³¢é‚£å¥‘"ã€"æ±‚è§£"
# RAG: æ–°å¢"æ–‡ä»¶"ã€"æ–‡æ¡£é—®ç­”"ã€"çŸ¥è¯†åº“"ã€"ä¸Šä¼ "
```

**æ•ˆæœéªŒè¯ï¼š**
- âœ… "å¸®æˆ‘ç®—ä¸€ä¸‹100çš„å¹³æ–¹" â†’ æˆåŠŸè¯†åˆ«ä¸ºCodeå·¥å…·
- âœ… "ä»Šå¤©æ°”æ¸©å¤šå°‘åº¦ï¼Ÿ" â†’ æˆåŠŸè¯†åˆ«ä¸ºWeatherå·¥å…·

---

### ğŸ› Phase 5.5: Bugä¿®å¤ (2025-11-23 å·²å®Œæˆ âœ…)

**å‘ç°æ—¶é—´**: 2025-11-23 æµ‹è¯•Routing Toolæ—¶
**å®Œæˆæ—¶é—´**: 2025-11-23

#### Bug #4: Routing Toolç±»å‹é”™è¯¯ âœ…
**é—®é¢˜æè¿°**:
- `extract_route()` è¿”å› `Tuple[str, str]`
- `master_agent.py:597` æœŸæœ› `Dict`ï¼Œè°ƒç”¨ `.get()` æ–¹æ³•å¯¼è‡´ `AttributeError`

**é”™è¯¯ä¿¡æ¯**:
```python
AttributeError: 'tuple' object has no attribute 'get'
```

**ä¿®å¤ä»£ç ** (`master_agent.py:586-605`):
```python
# ä¿®å¤å‰
route_info = extract_route(query)
if not route_info or not route_info.get("origin"):  # âŒ tupleæ²¡æœ‰.get()

# ä¿®å¤å
origin, destination = extract_route(query)  # âœ… å…ƒç»„è§£åŒ…
if not origin or not destination:
```

**æµ‹è¯•ç»“æœ**: âœ… è‹±æ–‡æŸ¥è¯¢æˆåŠŸï¼ˆ"Route from Beijing to Shanghai"ï¼‰

#### Bug #5: ä¸­æ–‡è·¯çº¿æå–æ”¹è¿› âœ…
**é—®é¢˜æè¿°**:
- åŸæ­£åˆ™åªæ”¯æŒ"ä»Xåˆ°Y"ï¼Œä¸æ”¯æŒ"ä»Xå»Y"
- æ— æ³•è¿‡æ»¤"çš„è·¯çº¿"ç­‰åç¼€

**ä¿®å¤ä»£ç ** (`entity_extractor.py:236-246`):
```python
# ä¿®å¤å‰
chinese_pattern = re.compile(r'ä»\s*([^\såˆ°]+)\s*åˆ°\s*([^\s]+)')

# ä¿®å¤å
chinese_pattern = re.compile(r'ä»\s*([^\såˆ°å»]+)\s*[åˆ°å»]\s*([^\sçš„éœ€è¦æ€ä¹ˆå—ï¼Ÿ]+)')
# æ·»åŠ åç¼€æ¸…ç†
destination = re.sub(r'(çš„è·¯çº¿|çš„å¯¼èˆª|è·¯çº¿|å¯¼èˆª)$', '', destination).strip()
```

**æ”¯æŒçš„æŸ¥è¯¢æ ¼å¼**:
- "ä»åŒ—äº¬åˆ°ä¸Šæµ·" âœ…
- "ä»åŒ—äº¬å»ä¸Šæµ·" âœ…
- "ä»åŒ—äº¬å»é•¿åŸçš„è·¯çº¿" âœ…ï¼ˆä¼šæ¸…ç†"çš„è·¯çº¿"åç¼€ï¼‰

**æµ‹è¯•ç»“æœ**: âœ… æ­£åˆ™æµ‹è¯•é€šè¿‡ï¼ˆOrigin: åŒ—äº¬, Destination: ä¸Šæµ·ï¼‰

---

### Phase 6: é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæƒ…å†µ (ä½ä¼˜å…ˆçº§)

#### 6.1 æ–‡ä»¶å¤§å°é™åˆ¶
- [ ] æ·»åŠ æ–‡ä»¶å¤§å°æ£€æŸ¥ï¼ˆå‰ç«¯+åç«¯ï¼‰
- [ ] å‹å¥½çš„é”™è¯¯æç¤º

**æ¨èé™åˆ¶ï¼š**
- å›¾ç‰‡ï¼š10MB
- æ–‡æ¡£ï¼š50MB

#### 6.2 è¶…æ—¶å¤„ç†
- [ ] ä¸ºé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡æ·»åŠ è¶…æ—¶
- [ ] å‰ç«¯æ˜¾ç¤ºè¶…æ—¶æç¤º

#### 6.3 å¹¶å‘é™åˆ¶
- [ ] é™åˆ¶åŒæ—¶å¤„ç†çš„æ–‡ä»¶æ•°é‡
- [ ] é˜Ÿåˆ—æœºåˆ¶ï¼ˆå¦‚æœéœ€è¦ï¼‰

---

### Phase 7: æµ‹è¯•å’Œæ–‡æ¡£ (ä½ä¼˜å…ˆçº§)

#### 7.1 ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æµ‹è¯•æ‰€æœ‰å·¥å…·å•ç‹¬è°ƒç”¨
- [ ] æµ‹è¯•å¤šå·¥å…·ç»„åˆ
- [ ] æµ‹è¯•æ–‡ä»¶ä¸Šä¼ ï¼ˆå›¾ç‰‡+æ–‡æ¡£ï¼‰
- [ ] æµ‹è¯•é”™è¯¯å¤„ç†

**æµ‹è¯•æ¸…å•ï¼š**
```bash
# 1. å¤©æ°”æŸ¥è¯¢
curl -X POST "http://localhost:8005/query" -F "query=åŒ—äº¬å¤©æ°”"

# 2. è‚¡ç¥¨æŸ¥è¯¢
curl -X POST "http://localhost:8005/query" -F "query=AAPLè‚¡ä»·"

# 3. ä»£ç æ‰§è¡Œ
curl -X POST "http://localhost:8005/query" -F "query=è®¡ç®—fibonacci(10)"

# 4. å›¾ç‰‡ä¸Šä¼ 
curl -X POST "http://localhost:8005/query" \
  -F "query=è¿™æ˜¯ä»€ä¹ˆï¼Ÿ" \
  -F "file=@test.jpg"

# 5. æ–‡æ¡£ä¸Šä¼ 
curl -X POST "http://localhost:8005/query" \
  -F "query=æ€»ç»“è¿™ä¸ªæ–‡æ¡£" \
  -F "file=@test.pdf"

# 6. å¤šå·¥å…·ç»„åˆ
curl -X POST "http://localhost:8005/query" \
  -F "query=åŒ—äº¬å¤©æ°”å¦‚ä½•ï¼ŸAAPLè‚¡ä»·å¤šå°‘ï¼Ÿ"
```

#### 7.2 æ›´æ–°æ–‡æ¡£
- [ ] æ›´æ–° CLAUDE.mdï¼ˆå·²å®ŒæˆåŸºç¡€ç‰ˆæœ¬ï¼‰
- [ ] æ·»åŠ MasterAgentä½¿ç”¨è¯´æ˜
- [ ] æ·»åŠ APIæ–‡æ¡£
- [ ] æ·»åŠ æ¶æ„å›¾

---

## ğŸ› å·²çŸ¥é—®é¢˜å’Œæ½œåœ¨é—®é¢˜

### 1. ChatAgentè¿”å›æ ¼å¼ä¸ä¸€è‡´
**é—®é¢˜ï¼š** `chat()` æ–¹æ³•å¯èƒ½è¿”å›stringæˆ–dict

**å½±å“ï¼š** MasterAgentæœŸæœ›è¿”å›string

**è§£å†³æ–¹æ¡ˆï¼š**
```python
# åœ¨MasterAgentä¸­ç»Ÿä¸€å¤„ç†
response = await self.chat_agent.chat(query)
if isinstance(response, dict):
    response = response.get("message", str(response))
```

### 2. WorkflowEngineåŠ¨æ€Taskæ”¯æŒ âœ… å·²ä¿®å¤
**çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤APIè°ƒç”¨æ–¹å¼

**åŸé—®é¢˜ï¼š** MasterAgenté”™è¯¯ä½¿ç”¨äº† `add_tasks()` å’Œ `execute(mode=...)`

**å·²å®æ–½çš„è§£å†³æ–¹æ¡ˆï¼š**
```python
# åˆ›å»ºWorkflowå¯¹è±¡
workflow = self.workflow_engine.create_workflow(
    workflow_id=f"master_plan_{task_plan.goal[:30]}",
    mode=ExecutionMode.DAG
)

# æ·»åŠ ä»»åŠ¡åˆ°workflow.tasks
for task in tasks:
    workflow.tasks[task.id] = task

# æ‰§è¡Œworkflow
await self.workflow_engine.execute(workflow)
```

**æµ‹è¯•ç»“æœï¼š** âœ… å¤šå·¥å…·ç»„åˆæŸ¥è¯¢æ­£å¸¸æ‰§è¡Œï¼Œæ— workflowé”™è¯¯

### 3. Entity Extractor âœ… å·²éªŒè¯å­˜åœ¨
**çŠ¶æ€ï¼š** âœ… å·²ç¡®è®¤æ‰€æœ‰å‡½æ•°éƒ½å·²å®ç°

**éªŒè¯ç»“æœï¼š**
- `extract_location()` âœ… å­˜åœ¨
- `extract_stock_symbol()` âœ… å­˜åœ¨
- `extract_route()` âœ… å­˜åœ¨
- ä½ç½®: `src/utils/entity_extractor.py`

### 4. Dockeræœªå®‰è£…æ—¶çš„é™çº§
**çŠ¶æ€ï¼š** âœ… å·²å¤„ç†ï¼ˆä¼šfallbackåˆ°subprocessï¼‰

**è­¦å‘Šä¿¡æ¯ï¼š** å¯å¿½ç•¥

### 5. RAGæ–‡æ¡£ä¸Šä¼ çš„å¼‚æ­¥å¤„ç†
**æ½œåœ¨é—®é¢˜ï¼š** æ–‡æ¡£ä¸Šä¼ æ˜¯åå°å¼‚æ­¥çš„ï¼Œç”¨æˆ·å¯èƒ½ç«‹å³æŸ¥è¯¢

**è§£å†³æ–¹æ¡ˆï¼š**
```python
# é€‰é¡¹1ï¼šåŒæ­¥ä¸Šä¼ ï¼ˆé˜»å¡ï¼‰
await self.rag_agent.upload_document(file_path)

# é€‰é¡¹2ï¼šè¿”å›"æ–‡æ¡£æ­£åœ¨å¤„ç†"æ¶ˆæ¯
if file_ext in ['pdf', 'txt', ...]:
    return {
        "answer": "æ–‡æ¡£å·²ä¸Šä¼ ï¼Œæ­£åœ¨åå°å¤„ç†ã€‚ç¨åå¯ä»¥æŸ¥è¯¢å†…å®¹ã€‚",
        ...
    }
```

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼ˆå¯é€‰ï¼‰

### 1. ç¼“å­˜LLMå“åº”
- [ ] ä¸ºå¸¸è§æŸ¥è¯¢ç¼“å­˜TaskDecomposerç»“æœ
- [ ] ä¸ºå·¥å…·ç»“æœæ·»åŠ TTLç¼“å­˜

### 2. å¹¶è¡Œæ‰§è¡Œä¼˜åŒ–
- [ ] ç¡®ä¿æ— ä¾èµ–çš„å­ä»»åŠ¡çœŸæ­£å¹¶è¡Œæ‰§è¡Œ
- [ ] ä½¿ç”¨ `asyncio.gather()` æ›¿ä»£é¡ºåºæ‰§è¡Œ

### 3. å‡å°‘LLMè°ƒç”¨
- [ ] ç®€å•æŸ¥è¯¢ç›´æ¥è·¯ç”±ï¼Œä¸ç”¨TaskDecomposer
- [ ] å·¥å…·ç»“æœæ ¼å¼åŒ–ç”¨æ¨¡æ¿è€ŒéLLM

---

## ğŸ¯ æµ‹è¯•éªŒæ”¶æ ‡å‡† (2025-11-23 å…¨éƒ¨é€šè¿‡ âœ…)

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

#### âœ… æµ‹è¯•1ï¼šå¤©æ°”æŸ¥è¯¢ - **å·²é€šè¿‡**
**è¾“å…¥ï¼š** "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[weather]
- ç­”æ¡ˆåŒ…å«ï¼šæ¸©åº¦ã€å¤©æ°”çŠ¶å†µã€æ¹¿åº¦ç­‰
- æ ¼å¼ï¼šè‡ªç„¶è¯­è¨€

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OK
```bash
curl -X POST "http://localhost:8005/query" -F "query=åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
```

#### âœ… æµ‹è¯•2ï¼šè‚¡ç¥¨æŸ¥è¯¢ - **å·²é€šè¿‡**
**è¾“å…¥ï¼š** "AAPLè‚¡ä»·å¤šå°‘ï¼Ÿ"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[finance]
- ç­”æ¡ˆåŒ…å«ï¼šè‚¡ä»·ã€æ¶¨è·Œç­‰
- æ ¼å¼ï¼šè‡ªç„¶è¯­è¨€

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OK
```bash
curl -X POST "http://localhost:8005/query" -F "query=AAPLè‚¡ä»·å¤šå°‘ï¼Ÿ"
```

#### âœ… æµ‹è¯•3ï¼šä»£ç æ‰§è¡Œ - **å·²é€šè¿‡**
**è¾“å…¥ï¼š** "è®¡ç®—fibonacciæ•°åˆ—çš„ç¬¬10é¡¹"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[code]
- ç­”æ¡ˆåŒ…å«ï¼š55ï¼ˆæ­£ç¡®ç»“æœï¼‰
- æ˜¾ç¤ºä»£ç å’Œè¾“å‡º

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OKï¼Œè¾“å‡º55ï¼ˆæ­£ç¡®ï¼‰
```bash
curl -X POST "http://localhost:8005/query" -F "query=è®¡ç®—fibonacciæ•°åˆ—çš„ç¬¬10é¡¹"
# æœåŠ¡å™¨æ—¥å¿—æ˜¾ç¤º: The 10th Fibonacci number is: 55
```

#### âœ… æµ‹è¯•4ï¼šå›¾ç‰‡åˆ†æï¼ˆVisionï¼‰ - **å·²é€šè¿‡**
**æ“ä½œï¼š** ä¸Šä¼ å›¾ç‰‡ + "è¿™æ˜¯ä»€ä¹ˆï¼Ÿ"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[vision]
- ç­”æ¡ˆæè¿°å›¾ç‰‡å†…å®¹
- æ˜¾ç¤ºæ–‡ä»¶å

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OK
```bash
curl -X POST "http://localhost:8005/query" \
  -F "query=è¿™æ˜¯ä»€ä¹ˆå›¾ç‰‡ï¼Ÿ" \
  -F "file=@./test_data/test_image.png"
```

#### âœ… æµ‹è¯•5ï¼šæ–‡å­—è¯†åˆ«ï¼ˆOCRï¼‰ - **å·²é€šè¿‡**
**æ“ä½œï¼š** ä¸Šä¼ åŒ…å«æ–‡å­—çš„å›¾ç‰‡ + "æå–æ–‡å­—"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[ocr]
- è¿”å›æå–çš„æ–‡å­—
- æ˜¾ç¤ºç½®ä¿¡åº¦

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OK
```bash
curl -X POST "http://localhost:8005/query" \
  -F "query=æå–å›¾ç‰‡ä¸­çš„æ–‡å­—" \
  -F "file=@./test_data/test_image_chinese.png"
```

#### âœ… æµ‹è¯•6ï¼šæ–‡æ¡£ä¸Šä¼ ï¼ˆRAGï¼‰ - **å·²é€šè¿‡**
**æ“ä½œï¼š** ä¸Šä¼ PDF + "è¿™ä¸ªæ–‡æ¡£è®²ä»€ä¹ˆï¼Ÿ"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[rag]
- è¿”å›æ–‡æ¡£æ‘˜è¦
- æç¤ºæ–‡æ¡£å·²æ·»åŠ åˆ°çŸ¥è¯†åº“

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OKï¼ˆæ–‡æ¡£æˆåŠŸä¸Šä¼ åˆ°RAGï¼‰
```bash
curl -X POST "http://localhost:8005/query" \
  -F "query=æ€»ç»“è¿™ä¸ªæ–‡æ¡£çš„å†…å®¹" \
  -F "file=@./tmp.pdf"
# æœåŠ¡å™¨æ—¥å¿—: Document uploaded to RAG: tmp.pdf
```

#### âœ… æµ‹è¯•7ï¼šå¤šå·¥å…·ç»„åˆ - **å·²é€šè¿‡**
**è¾“å…¥ï¼š** "åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼ŸAAPLè‚¡ä»·æ˜¯å¤šå°‘ï¼Ÿ"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[weather, finance]
- ç­”æ¡ˆæ•´åˆä¸¤ä¸ªä¿¡æ¯
- æ ¼å¼æ¸…æ™°

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OKï¼ˆå¤šå·¥å…·å¹¶è¡Œæ‰§è¡ŒæˆåŠŸï¼‰
```bash
curl -X POST "http://localhost:8005/query" \
  -F "query=åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼ŸTSLAè‚¡ä»·å¤šå°‘ï¼Ÿ"
# æ— workflowé”™è¯¯ï¼Œæ­£å¸¸æ‰§è¡Œ
```

#### âœ… æµ‹è¯•8ï¼šèŠå¤© - **å·²é€šè¿‡**
**è¾“å…¥ï¼š** "ç»™æˆ‘è®²ä¸ªç¬‘è¯"

**é¢„æœŸè¾“å‡ºï¼š**
- å·¥å…·è°ƒç”¨ï¼š[chat]
- è¿”å›æœ‰è¶£çš„å†…å®¹

**å®é™…æµ‹è¯•ç»“æœï¼š** âœ… 200 OK
```bash
curl -X POST "http://localhost:8005/query" -F "query=ç»™æˆ‘è®²ä¸ªç¬‘è¯"
```

---

### æµ‹è¯•æ€»ç»“

**æµ‹è¯•æ—¶é—´**: 2025-11-23
**æ€»è®¡**: 8ä¸ªæµ‹è¯•ç”¨ä¾‹
**é€šè¿‡**: 8/8 (100%)
**å¤±è´¥**: 0/8 (0%)

**ç³»ç»ŸçŠ¶æ€**: âœ… **æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ**

---

## ğŸ“ å…³é”®æ–‡ä»¶æ¸…å•

### å·²ä¿®æ”¹çš„æ–‡ä»¶

1. **æ–°å»ºæ–‡ä»¶ï¼š**
   - `src/agents/master_agent.py` (650è¡Œ) - æ ¸å¿ƒMasterAgent
   - `src/web/templates/components/result_unified.html` (280è¡Œ) - ç»Ÿä¸€ç»“æœæ¨¡æ¿
   - `TODO_MASTER_AGENT.md` (æœ¬æ–‡ä»¶) - TODOæ¸…å•

2. **é‡å†™æ–‡ä»¶ï¼š**
   - `src/web/routers/query.py` (462è¡Œ â†’ 170è¡Œ) - ç®€åŒ–ä¸ºMasterAgentè°ƒç”¨

3. **ä¿®æ”¹æ–‡ä»¶ï¼š**
   - `src/web/templates/pages/home.html` - æ·»åŠ æ–‡ä»¶ä¸Šä¼ 
   - `src/web/dependencies/core.py` - æ·»åŠ get_master_agent()
   - `src/web/dependencies/__init__.py` - å¯¼å‡ºget_master_agent
   - `src/web/dependencies/tools.py` - ä¿®å¤VisionToolåˆå§‹åŒ–
   - `src/agents/__init__.py` - å¯¼å‡ºMasterAgent
   - `src/tools/weather_tool.py` - ä¿®å¤æ¸©åº¦å•ä½è½¬æ¢

4. **å¤‡ä»½æ–‡ä»¶ï¼š**
   - `src/web/routers/query.py.backup` - åŸå§‹query.pyå¤‡ä»½

### éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶

- `src/utils/entity_extractor.py` - ç¡®è®¤æå–å‡½æ•°å­˜åœ¨
- `src/workflow/workflow_engine.py` - ç¡®è®¤Task API
- `src/agents/chat_agent.py` - ç¡®è®¤chat()è¿”å›æ ¼å¼
- `src/agents/rag_agent.py` - ç¡®è®¤upload_document()å’Œquery()

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æŒ‡å—

### 1. å¯åŠ¨æœåŠ¡å™¨
```bash
cd /Users/sudo/PycharmProjects/ai_search
uvicorn src.web.app:app --reload --host 0.0.0.0 --port 8005
```

### 2. è®¿é—®ä¸»é¡µ
```
http://localhost:8005
```

### 3. æµ‹è¯•åŠŸèƒ½
- è¾“å…¥æŸ¥è¯¢ï¼š"åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
- æˆ–ä¸Šä¼ æ–‡ä»¶ + è¾“å…¥é—®é¢˜

### 4. æŸ¥çœ‹æ—¥å¿—
è§‚å¯Ÿç»ˆç«¯è¾“å‡ºï¼Œæ£€æŸ¥ï¼š
- å·¥å…·è°ƒç”¨é¡ºåº
- LLMå¢å¼ºè¿‡ç¨‹
- é”™è¯¯ä¿¡æ¯

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šAttributeError: 'XXXTool' object has no attribute 'method_name'
**åŸå› ï¼š** å·¥å…·APIæ–¹æ³•åä¸åŒ¹é…

**è§£å†³ï¼š** æ£€æŸ¥å·¥å…·ç±»çš„å®é™…æ–¹æ³•åï¼Œä¿®æ”¹MasterAgentä¸­çš„è°ƒç”¨

### é—®é¢˜2ï¼šTemplateNotFound: result_unified.html
**åŸå› ï¼š** æ¨¡æ¿è·¯å¾„é”™è¯¯

**è§£å†³ï¼š** ä½¿ç”¨ `components/result_unified.html`

### é—®é¢˜3ï¼šTaskå¯¹è±¡ä¸æ”¯æŒçš„å‚æ•°
**åŸå› ï¼š** WorkflowEngineçš„Taskç±»APIä¸åŒ

**è§£å†³ï¼š** æŸ¥çœ‹Taskç±»å®šä¹‰ï¼Œè°ƒæ•´å‚æ•°æˆ–ä¸ä½¿ç”¨WorkflowEngine

### é—®é¢˜4ï¼šextract_locationæœªå®šä¹‰
**åŸå› ï¼š** entity_extractoræ¨¡å—ç¼ºå¤±å‡½æ•°

**è§£å†³ï¼š** ç›´æ¥ä½¿ç”¨queryä½œä¸ºå‚æ•°ï¼Œæˆ–å®ç°æå–å‡½æ•°

---

## ğŸ’¡ ä¸‹ä¸€æ­¥å»ºè®®

### ä¼˜å…ˆçº§1ï¼ˆå¿…é¡»å®Œæˆï¼‰
1. æµ‹è¯•æ‰€æœ‰åŸºæœ¬åŠŸèƒ½ï¼ˆå¤©æ°”ã€è‚¡ç¥¨ã€ä»£ç ã€èŠå¤©ï¼‰
2. ä¿®å¤å‘ç°çš„ä»»ä½•APIä¸åŒ¹é…é—®é¢˜
3. ç¡®ä¿æ–‡ä»¶ä¸Šä¼ æ­£å¸¸å·¥ä½œ

### ä¼˜å…ˆçº§2ï¼ˆé‡è¦ä½†éç´§æ€¥ï¼‰
1. å®Œå–„é”™è¯¯å¤„ç†
2. ä¼˜åŒ–UI/UX
3. æ·»åŠ è¿›åº¦æŒ‡ç¤º

### ä¼˜å…ˆçº§3ï¼ˆé”¦ä¸Šæ·»èŠ±ï¼‰
1. æ€§èƒ½ä¼˜åŒ–
2. å®Œå–„æ–‡æ¡£
3. æ·»åŠ æ›´å¤šç¤ºä¾‹

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### 2025-11-23 â­ æ ¸å¿ƒåŠŸèƒ½å®Œæˆ + UI/UXä¼˜åŒ–

**Phase 0: å…³é”®Bugä¿®å¤**
- âœ… ä¿®å¤RAGAgent APIè°ƒç”¨ï¼ˆupload_document â†’ ingest_documentï¼‰
- âœ… ä¿®å¤WorkflowEngineä½¿ç”¨æ–¹å¼ï¼ˆcreate_workflow + executeï¼‰
- âœ… ä¿®å¤Workflowä¾èµ–æ³¨å…¥ï¼ˆtask_funcæ·»åŠ **kwargsï¼‰

**Phase 3: åŠŸèƒ½éªŒè¯æµ‹è¯•**
- âœ… éªŒè¯ChatAgent.chat()æ­£å¸¸å·¥ä½œ
- âœ… éªŒè¯RAGAgent.ingest_document()å’Œquery()
- âœ… éªŒè¯WorkflowEngine DAGæ¨¡å¼æ‰§è¡Œ
- âœ… éªŒè¯Entity Extractoræ‰€æœ‰å‡½æ•°å­˜åœ¨

**ç»¼åˆæµ‹è¯• (8/8é€šè¿‡)**
- âœ… èŠå¤©åŠŸèƒ½æµ‹è¯•é€šè¿‡
- âœ… å¤©æ°”æŸ¥è¯¢æµ‹è¯•é€šè¿‡
- âœ… ä»£ç æ‰§è¡Œæµ‹è¯•é€šè¿‡ï¼ˆfibonacci(10)=55ï¼‰
- âœ… è‚¡ç¥¨æŸ¥è¯¢æµ‹è¯•é€šè¿‡
- âœ… å›¾ç‰‡åˆ†æ(Vision)æµ‹è¯•é€šè¿‡
- âœ… æ–‡å­—è¯†åˆ«(OCR)æµ‹è¯•é€šè¿‡
- âœ… æ–‡æ¡£ä¸Šä¼ (RAG)æµ‹è¯•é€šè¿‡
- âœ… å¤šå·¥å…·ç»„åˆæµ‹è¯•é€šè¿‡ï¼ˆæ— workflowé”™è¯¯ï¼‰

**Phase 4: UI/UXä¼˜åŒ– (5/5å®Œæˆ)**
- âœ… æ·»åŠ é¡µé¢é‡å®šå‘ï¼ˆ/rag, /multimodal, /tools, /workflow â†’ /ï¼‰
- âœ… æ›´æ–°å¯¼èˆªæ æ ‡ç­¾ï¼ˆ"New" â†’ "é›†æˆ"ï¼‰
- âœ… å¢å¼ºåŠ è½½åŠ¨ç”»ï¼ˆå‘å…‰spinner + è„‰åŠ¨æ–‡æœ¬ + ç‚¹ç‚¹ç‚¹æ•ˆæœï¼‰
- âœ… ä¼˜åŒ–æ–‡ä»¶ä¸Šä¼ åŒºåŸŸï¼ˆæ‰«å…‰æ•ˆæœ + ä¸Šç§»åŠ¨ç”» + æ‹–æ‹½åé¦ˆï¼‰
- âœ… æ·»åŠ å·¥å…·æµç¨‹å¯è§†åŒ–ï¼ˆQuery â†’ Tools â†’ Answeræµç¨‹å›¾ï¼‰

**è§†è§‰æ•ˆæœæå‡**:
- åŠ è½½ä½“éªŒï¼šç®€å•spinner â†’ å¸¦å‘å…‰æ•ˆæœçš„åŠ¨æ€spinner + è„‰åŠ¨æ–‡æœ¬
- æ–‡ä»¶ä¸Šä¼ ï¼šåŸºç¡€è™šçº¿æ¡† â†’ å¸¦æ‰«å…‰ã€é˜´å½±ã€åŠ¨ç”»çš„ç°ä»£ä¸Šä¼ åŒº
- å·¥å…·å±•ç¤ºï¼šç®€å•badgeåˆ—è¡¨ â†’ å¯è§†åŒ–æ‰§è¡Œæµç¨‹å›¾

**Phase 5: TaskDecomposerå¢å¼º (3/3å®Œæˆ)**
- âœ… ç¡®è®¤AVAILABLE_TOOLSåŒ…å«å…¨éƒ¨9ä¸ªå·¥å…·
- âœ… æ·»åŠ 3ä¸ªå¤šå·¥å…·ç»„åˆç¤ºä¾‹ï¼ˆå¤©æ°”+è·¯çº¿ã€å¤©æ°”+è‚¡ç¥¨ã€å›¾ç‰‡åˆ†æ+OCRï¼‰
- âœ… æ‰©å±•ä¸­æ–‡å…³é”®è¯ï¼ˆweather/finance/routing/ocr/vision/code/ragå…¨éƒ¨å¢å¼ºï¼‰

**Bugä¿®å¤ #4-#5: Routing Tool**
- âœ… ä¿®å¤tupleç±»å‹é”™è¯¯ï¼ˆextract_routeè¿”å›tupleï¼Œä»£ç æœŸæœ›dictï¼‰
- âœ… æ”¹è¿›ä¸­æ–‡è·¯çº¿æå–ï¼ˆæ”¯æŒ"ä»Xå»Y"ï¼Œæ¸…ç†"çš„è·¯çº¿"åç¼€ï¼‰

**æ¶æ„ä¼˜åŒ–ï¼šLLMä¼˜å…ˆç­–ç•¥**
- âœ… Weather/Finance/Routingæ”¹ä¸ºä¼˜å…ˆä½¿ç”¨LLMæå–çš„å‚æ•°
- âœ… æ­£åˆ™è¡¨è¾¾å¼ä»…ä½œä¸ºfallbackæœºåˆ¶
- âœ… å¤§å¹…æå‡è¯­ä¹‰ç†è§£å®¹é”™ç‡

**æµ‹è¯•éªŒè¯**:
- âœ… "è‹¹æœå…¬å¸å¸‚å€¼å¤šå°‘ï¼Ÿ" â†’ æˆåŠŸè¯†åˆ«Financeå·¥å…· + æå–AAPLç¬¦å·
- âœ… "å¸®æˆ‘ç®—ä¸€ä¸‹100çš„å¹³æ–¹" â†’ æˆåŠŸè¯†åˆ«Codeå·¥å…·ï¼ˆå…³é”®è¯"ç®—"ï¼‰
- âœ… "Route from Beijing to Shanghai" â†’ æˆåŠŸæå–origin/destination

**ç³»ç»ŸçŠ¶æ€**: ğŸ‰ **æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œï¼UI/UXæ˜¾è‘—æå‡ï¼Phase 5å®Œæˆï¼**

### 2025-11-22
- âœ… åˆ›å»ºMasterAgentæ ¸å¿ƒæ¡†æ¶
- âœ… ç®€åŒ–query.pyï¼ˆ462â†’170è¡Œï¼‰
- âœ… æ·»åŠ æ–‡ä»¶ä¸Šä¼ åˆ°ä¸»é¡µé¢
- âœ… åˆ›å»ºç»Ÿä¸€ç»“æœæ¨¡æ¿
- âœ… ä¿®å¤æ¨¡æ¿è·¯å¾„é”™è¯¯
- âœ… ä¿®å¤WeatherTool APIï¼ˆget_weather â†’ get_current_weatherï¼‰
- âœ… ä¿®å¤FinanceTool APIï¼ˆget_stock_data â†’ get_stock_priceï¼‰
- âœ… ä¿®å¤VisionToolåˆå§‹åŒ–å‚æ•°
- âœ… ä¿®å¤WeatherToolæ¸©åº¦å•ä½è½¬æ¢ï¼ˆmetric â†’ celsiusï¼‰
- âœ… å®Œæˆä¾èµ–æ³¨å…¥ç³»ç»Ÿ
- âœ… åˆ›å»ºæœ¬TODOæ–‡ä»¶

---

## ğŸ“ æ¶æ„è¯´æ˜

### æ•°æ®æµå›¾

```
ç”¨æˆ·è¾“å…¥ï¼ˆæ–‡æœ¬ + å¯é€‰æ–‡ä»¶ï¼‰
    â†“
home.htmlï¼ˆæ–‡ä»¶ä¸Šä¼ è¡¨å•ï¼‰
    â†“
POST /queryï¼ˆFastAPIè·¯ç”±ï¼‰
    â†“
MasterAgent.process_query()
    â†“
    â”œâ”€ æ–‡ä»¶å¤„ç†åˆ†æ”¯
    â”‚   â”œâ”€ å›¾ç‰‡ â†’ OCR/Visionï¼ˆå³æ—¶ï¼‰
    â”‚   â””â”€ æ–‡æ¡£ â†’ RAGï¼ˆåå°å¼‚æ­¥ï¼‰
    â”‚
    â””â”€ ä»»åŠ¡åˆ†è§£åˆ†æ”¯
        â†“
    TaskDecomposer.decompose()
        â†“
    WorkflowEngine.execute()
        â†“
    å¹¶è¡Œè°ƒç”¨å¤šä¸ªå·¥å…·
    â”œâ”€ ResearchAgent
    â”œâ”€ CodeAgent
    â”œâ”€ WeatherTool
    â”œâ”€ FinanceTool
    â””â”€ ...
        â†“
    ResultAggregator.aggregate()
        â†“
    ChatAgentå¢å¼ºï¼ˆLLMç”Ÿæˆè‡ªç„¶è¯­è¨€ï¼‰
        â†“
    è¿”å›ç»Ÿä¸€æ ¼å¼ç»“æœ
        â†“
components/result_unified.htmlï¼ˆæ¸²æŸ“ï¼‰
```

### å…³é”®è®¾è®¡å†³ç­–

1. **ä¸ºä»€ä¹ˆä¸ç”¨Function Callingï¼Ÿ**
   - ä¸ä¾èµ–ç‰¹å®šLLMç‰¹æ€§
   - æ›´çµæ´»çš„å·¥ä½œæµæ§åˆ¶
   - æ”¯æŒä»»ä½•OpenAIå…¼å®¹çš„LLM

2. **ä¸ºä»€ä¹ˆç”¨WorkflowEngineï¼Ÿ**
   - æ”¯æŒå¤æ‚ä»»åŠ¡ç¼–æ’
   - æ”¯æŒå¹¶è¡Œæ‰§è¡Œ
   - æ”¯æŒä¾èµ–ç®¡ç†

3. **ä¸ºä»€ä¹ˆç”¨MasterAgentï¼Ÿ**
   - å•ä¸€å…¥å£ï¼Œç®€åŒ–è·¯ç”±é€»è¾‘
   - é›†ä¸­ç®¡ç†å·¥å…·è°ƒç”¨
   - ç»Ÿä¸€ç»“æœæ ¼å¼

---

**æœ€åæ›´æ–°ï¼š** 2025-11-23 17:30
**å½“å‰çŠ¶æ€ï¼š** ğŸ‰ **æ ¸å¿ƒåŠŸèƒ½ + UI/UX + TaskDecomposerä¼˜åŒ–å®Œæˆï¼ç³»ç»Ÿå®Œå…¨å¯ç”¨ï¼**

**è¿è¡ŒæœåŠ¡å™¨**: `uvicorn src.web.app:app --reload --host 0.0.0.0 --port 8005`
**è®¿é—®åœ°å€**: http://localhost:8005

**å·²å®Œæˆçš„Phase**:
- âœ… Phase 1: æ ¸å¿ƒæ¶æ„ (2025-11-22)
- âœ… Phase 2: Bugä¿®å¤ (2025-11-22)
- âœ… Phase 0: å…³é”®Bugä¿®å¤ (2025-11-23 ä¸Šåˆ)
- âœ… Phase 3: åŠŸèƒ½éªŒè¯æµ‹è¯• (2025-11-23 ä¸Šåˆ)
- âœ… Phase 4: UI/UXä¼˜åŒ– (2025-11-23 ä¸Šåˆ)
- âœ… Phase 5: TaskDecomposerå¢å¼º (2025-11-23 ä¸‹åˆ)
- âœ… Phase 5.5: Routing Bugä¿®å¤ + LLMä¼˜å…ˆæ¶æ„ (2025-11-23 ä¸‹åˆ)

**å¾…å®Œæˆçš„Phaseï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰**:
- â³ Phase 6: é”™è¯¯å¤„ç†ï¼ˆæ–‡ä»¶å¤§å°é™åˆ¶ã€è¶…æ—¶ã€å¹¶å‘ï¼‰
- â³ Phase 7: æµ‹è¯•å’Œæ–‡æ¡£ï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ã€APIæ–‡æ¡£ã€æ¶æ„å›¾ï¼‰

**å®Œæˆè¿›åº¦**: 7/9 Phase (77.8%)
- æ ¸å¿ƒåŠŸèƒ½: 100% âœ… (Phase 0, 1, 2, 3)
- UI/UXä¼˜åŒ–: 100% âœ… (Phase 4)
- TaskDecomposer: 100% âœ… (Phase 5, 5.5)
- é«˜çº§ä¼˜åŒ–: 0% (å¯é€‰) (Phase 6, 7)
